import{_ as s,c as a,a as p,o as e}from"./app-BtFOZcMJ.js";const t={};function l(c,n){return e(),a("div",null,n[0]||(n[0]=[p(`<h1 id="spring-bootåœ¨ä¸‰ç»´æ•°æ®å¤„ç†ç³»ç»Ÿä¸­çš„åº”ç”¨å®è·µ-â˜•" tabindex="-1"><a class="header-anchor" href="#spring-bootåœ¨ä¸‰ç»´æ•°æ®å¤„ç†ç³»ç»Ÿä¸­çš„åº”ç”¨å®è·µ-â˜•"><span>Spring Bootåœ¨ä¸‰ç»´æ•°æ®å¤„ç†ç³»ç»Ÿä¸­çš„åº”ç”¨å®è·µ â˜•</span></a></h1><blockquote><p>å°†å­¦æœ¯ç ”ç©¶ä¸å·¥ç¨‹å®è·µç»“åˆï¼Œç”¨Spring Bootæ„å»ºé«˜æ€§èƒ½çš„ä¸‰ç»´æ•°æ®å¤„ç†åç«¯æœåŠ¡</p></blockquote><h2 id="é¡¹ç›®èƒŒæ™¯-ğŸ¯" tabindex="-1"><a class="header-anchor" href="#é¡¹ç›®èƒŒæ™¯-ğŸ¯"><span>é¡¹ç›®èƒŒæ™¯ ğŸ¯</span></a></h2><p>åœ¨è¿›è¡Œä¸‰ç»´é‡å»ºç ”ç©¶çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘å‘ç°éœ€è¦ä¸€ä¸ªç¨³å®šã€é«˜æ•ˆçš„åç«¯ç³»ç»Ÿæ¥å¤„ç†å¤§é‡çš„ä¸‰ç»´æ•°æ®ã€‚ä¼ ç»Ÿçš„Pythonè„šæœ¬è™½ç„¶åœ¨ç®—æ³•åŸå‹å¼€å‘ä¸­å¾ˆæ–¹ä¾¿ï¼Œä½†åœ¨å¤„ç†å¹¶å‘è¯·æ±‚å’Œå¤§è§„æ¨¡æ•°æ®æ—¶æ€§èƒ½æœ‰é™ã€‚å› æ­¤ï¼Œæˆ‘å†³å®šä½¿ç”¨Spring Bootæ„å»ºä¸€ä¸ªä¸“é—¨çš„ä¸‰ç»´æ•°æ®å¤„ç†ç³»ç»Ÿã€‚</p><h2 id="ç³»ç»Ÿæ¶æ„è®¾è®¡-ğŸ—ï¸" tabindex="-1"><a class="header-anchor" href="#ç³»ç»Ÿæ¶æ„è®¾è®¡-ğŸ—ï¸"><span>ç³»ç»Ÿæ¶æ„è®¾è®¡ ğŸ—ï¸</span></a></h2><h3 id="æ•´ä½“æ¶æ„" tabindex="-1"><a class="header-anchor" href="#æ•´ä½“æ¶æ„"><span>æ•´ä½“æ¶æ„</span></a></h3><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
<span class="line">â”‚   å‰ç«¯Webç•Œé¢    â”‚    â”‚   ç§»åŠ¨ç«¯App     â”‚    â”‚   ç¬¬ä¸‰æ–¹API     â”‚</span>
<span class="line">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>
<span class="line">         â”‚                       â”‚                       â”‚</span>
<span class="line">         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>
<span class="line">                                 â”‚</span>
<span class="line">                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
<span class="line">                    â”‚   API Gateway   â”‚</span>
<span class="line">                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>
<span class="line">                                 â”‚</span>
<span class="line">         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
<span class="line">         â”‚                       â”‚                       â”‚</span>
<span class="line">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
<span class="line">â”‚   ç”¨æˆ·æœåŠ¡       â”‚    â”‚   æ•°æ®å¤„ç†æœåŠ¡   â”‚    â”‚   æ–‡ä»¶æœåŠ¡       â”‚</span>
<span class="line">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>
<span class="line">         â”‚                       â”‚                       â”‚</span>
<span class="line">         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>
<span class="line">                                 â”‚</span>
<span class="line">                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
<span class="line">                    â”‚   æ•°æ®å­˜å‚¨å±‚     â”‚</span>
<span class="line">                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="æŠ€æœ¯é€‰å‹" tabindex="-1"><a class="header-anchor" href="#æŠ€æœ¯é€‰å‹"><span>æŠ€æœ¯é€‰å‹</span></a></h3><ul><li><strong>Webæ¡†æ¶</strong>: Spring Boot 2.7.x</li><li><strong>æ•°æ®åº“</strong>: MySQL 8.0 + Redis 6.x</li><li><strong>æ¶ˆæ¯é˜Ÿåˆ—</strong>: RabbitMQ</li><li><strong>æ–‡ä»¶å­˜å‚¨</strong>: MinIO</li><li><strong>ç›‘æ§</strong>: Micrometer + Prometheus</li></ul><h2 id="æ ¸å¿ƒåŠŸèƒ½å®ç°-âš¡" tabindex="-1"><a class="header-anchor" href="#æ ¸å¿ƒåŠŸèƒ½å®ç°-âš¡"><span>æ ¸å¿ƒåŠŸèƒ½å®ç° âš¡</span></a></h2><h3 id="_1-å¼‚æ­¥æ–‡ä»¶ä¸Šä¼ å¤„ç†" tabindex="-1"><a class="header-anchor" href="#_1-å¼‚æ­¥æ–‡ä»¶ä¸Šä¼ å¤„ç†"><span>1. å¼‚æ­¥æ–‡ä»¶ä¸Šä¼ å¤„ç†</span></a></h3><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java"><pre><code class="language-java"><span class="line"><span class="token annotation punctuation">@RestController</span></span>
<span class="line"><span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/api/v1/pointcloud&quot;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PointCloudController</span> <span class="token punctuation">{</span></span>
<span class="line">    </span>
<span class="line">    <span class="token annotation punctuation">@Autowired</span></span>
<span class="line">    <span class="token keyword">private</span> <span class="token class-name">PointCloudService</span> pointCloudService<span class="token punctuation">;</span></span>
<span class="line">    </span>
<span class="line">    <span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/upload&quot;</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token class-name">ResponseEntity</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">UploadResponse</span><span class="token punctuation">&gt;</span></span> <span class="token function">uploadPointCloud</span><span class="token punctuation">(</span></span>
<span class="line">            <span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span><span class="token string">&quot;file&quot;</span><span class="token punctuation">)</span> <span class="token class-name">MultipartFile</span> file<span class="token punctuation">,</span></span>
<span class="line">            <span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span><span class="token string">&quot;algorithm&quot;</span><span class="token punctuation">)</span> <span class="token class-name">String</span> algorithm<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        </span>
<span class="line">        <span class="token comment">// å‚æ•°éªŒè¯</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isValidPointCloudFile</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">return</span> <span class="token class-name">ResponseEntity</span><span class="token punctuation">.</span><span class="token function">badRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">                <span class="token punctuation">.</span><span class="token function">body</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">UploadResponse</span><span class="token punctuation">(</span><span class="token string">&quot;ä¸æ”¯æŒçš„æ–‡ä»¶æ ¼å¼&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">        </span>
<span class="line">        <span class="token comment">// å¼‚æ­¥å¤„ç†</span></span>
<span class="line">        <span class="token class-name">String</span> taskId <span class="token operator">=</span> pointCloudService<span class="token punctuation">.</span><span class="token function">processAsync</span><span class="token punctuation">(</span>file<span class="token punctuation">,</span> algorithm<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        </span>
<span class="line">        <span class="token keyword">return</span> <span class="token class-name">ResponseEntity</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">UploadResponse</span><span class="token punctuation">(</span>taskId<span class="token punctuation">,</span> <span class="token string">&quot;ä¸Šä¼ æˆåŠŸï¼Œæ­£åœ¨å¤„ç†&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    </span>
<span class="line">    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/status/{taskId}&quot;</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token class-name">ResponseEntity</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ProcessingStatus</span><span class="token punctuation">&gt;</span></span> <span class="token function">getProcessingStatus</span><span class="token punctuation">(</span></span>
<span class="line">            <span class="token annotation punctuation">@PathVariable</span> <span class="token class-name">String</span> taskId<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token class-name">ProcessingStatus</span> status <span class="token operator">=</span> pointCloudService<span class="token punctuation">.</span><span class="token function">getStatus</span><span class="token punctuation">(</span>taskId<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token class-name">ResponseEntity</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span>status<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-ä»»åŠ¡é˜Ÿåˆ—å¤„ç†" tabindex="-1"><a class="header-anchor" href="#_2-ä»»åŠ¡é˜Ÿåˆ—å¤„ç†"><span>2. ä»»åŠ¡é˜Ÿåˆ—å¤„ç†</span></a></h3><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java"><pre><code class="language-java"><span class="line"><span class="token annotation punctuation">@Component</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PointCloudProcessor</span> <span class="token punctuation">{</span></span>
<span class="line">    </span>
<span class="line">    <span class="token annotation punctuation">@RabbitListener</span><span class="token punctuation">(</span>queues <span class="token operator">=</span> <span class="token string">&quot;pointcloud.processing&quot;</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">processPointCloud</span><span class="token punctuation">(</span><span class="token class-name">PointCloudTask</span> task<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">try</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token comment">// æ›´æ–°ä»»åŠ¡çŠ¶æ€</span></span>
<span class="line">            <span class="token function">updateTaskStatus</span><span class="token punctuation">(</span>task<span class="token punctuation">.</span><span class="token function">getTaskId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">TaskStatus</span><span class="token punctuation">.</span><span class="token constant">PROCESSING</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            </span>
<span class="line">            <span class="token comment">// è°ƒç”¨Pythonç®—æ³•å¤„ç†</span></span>
<span class="line">            <span class="token class-name">ProcessResult</span> result <span class="token operator">=</span> <span class="token function">callPythonAlgorithm</span><span class="token punctuation">(</span>task<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            </span>
<span class="line">            <span class="token comment">// ä¿å­˜ç»“æœ</span></span>
<span class="line">            <span class="token function">saveProcessingResult</span><span class="token punctuation">(</span>task<span class="token punctuation">.</span><span class="token function">getTaskId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            </span>
<span class="line">            <span class="token comment">// æ›´æ–°çŠ¶æ€ä¸ºå®Œæˆ</span></span>
<span class="line">            <span class="token function">updateTaskStatus</span><span class="token punctuation">(</span>task<span class="token punctuation">.</span><span class="token function">getTaskId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">TaskStatus</span><span class="token punctuation">.</span><span class="token constant">COMPLETED</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            </span>
<span class="line">        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;å¤„ç†ç‚¹äº‘æ•°æ®å¤±è´¥: {}&quot;</span><span class="token punctuation">,</span> e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token function">updateTaskStatus</span><span class="token punctuation">(</span>task<span class="token punctuation">.</span><span class="token function">getTaskId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">TaskStatus</span><span class="token punctuation">.</span><span class="token constant">FAILED</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    </span>
<span class="line">    <span class="token keyword">private</span> <span class="token class-name">ProcessResult</span> <span class="token function">callPythonAlgorithm</span><span class="token punctuation">(</span><span class="token class-name">PointCloudTask</span> task<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token comment">// ä½¿ç”¨ProcessBuilderè°ƒç”¨Pythonè„šæœ¬</span></span>
<span class="line">        <span class="token class-name">ProcessBuilder</span> pb <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ProcessBuilder</span><span class="token punctuation">(</span></span>
<span class="line">            <span class="token string">&quot;python&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;algorithms/reconstruct.py&quot;</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token string">&quot;--input&quot;</span><span class="token punctuation">,</span> task<span class="token punctuation">.</span><span class="token function">getInputPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token string">&quot;--algorithm&quot;</span><span class="token punctuation">,</span> task<span class="token punctuation">.</span><span class="token function">getAlgorithm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token string">&quot;--output&quot;</span><span class="token punctuation">,</span> task<span class="token punctuation">.</span><span class="token function">getOutputPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        </span>
<span class="line">        <span class="token comment">// æ‰§è¡Œå¹¶è¿”å›ç»“æœ</span></span>
<span class="line">        <span class="token class-name">Process</span> process <span class="token operator">=</span> pb<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">int</span> exitCode <span class="token operator">=</span> process<span class="token punctuation">.</span><span class="token function">waitFor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        </span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span>exitCode <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ProcessResult</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">,</span> task<span class="token punctuation">.</span><span class="token function">getOutputPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">&quot;ç®—æ³•æ‰§è¡Œå¤±è´¥&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-é…ç½®ä¼˜åŒ–" tabindex="-1"><a class="header-anchor" href="#_3-é…ç½®ä¼˜åŒ–"><span>3. é…ç½®ä¼˜åŒ–</span></a></h3><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml"><pre><code class="language-yaml"><span class="line"><span class="token comment"># application.yml</span></span>
<span class="line"><span class="token key atrule">spring</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">datasource</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>3306/reconstruction_db</span>
<span class="line">    <span class="token key atrule">username</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>DB_USERNAME<span class="token punctuation">:</span>admin<span class="token punctuation">}</span></span>
<span class="line">    <span class="token key atrule">password</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>DB_PASSWORD<span class="token punctuation">:</span>password<span class="token punctuation">}</span></span>
<span class="line">    <span class="token key atrule">hikari</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">maximum-pool-size</span><span class="token punctuation">:</span> <span class="token number">20</span></span>
<span class="line">      <span class="token key atrule">minimum-idle</span><span class="token punctuation">:</span> <span class="token number">5</span></span>
<span class="line">      </span>
<span class="line">  <span class="token key atrule">rabbitmq</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">host</span><span class="token punctuation">:</span> localhost</span>
<span class="line">    <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">5672</span></span>
<span class="line">    <span class="token key atrule">username</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>MQ_USERNAME<span class="token punctuation">:</span>guest<span class="token punctuation">}</span></span>
<span class="line">    <span class="token key atrule">password</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>MQ_PASSWORD<span class="token punctuation">:</span>guest<span class="token punctuation">}</span></span>
<span class="line">    </span>
<span class="line">  <span class="token key atrule">servlet</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">multipart</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">max-file-size</span><span class="token punctuation">:</span> 500MB</span>
<span class="line">      <span class="token key atrule">max-request-size</span><span class="token punctuation">:</span> 500MB</span>
<span class="line"></span>
<span class="line"><span class="token comment"># è‡ªå®šä¹‰é…ç½®</span></span>
<span class="line"><span class="token key atrule">reconstruction</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">algorithms</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">poisson</span><span class="token punctuation">:</span> <span class="token string">&quot;algorithms/poisson_reconstruct.py&quot;</span></span>
<span class="line">    <span class="token key atrule">delaunay</span><span class="token punctuation">:</span> <span class="token string">&quot;algorithms/delaunay_reconstruct.py&quot;</span></span>
<span class="line">  <span class="token key atrule">storage</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">base-path</span><span class="token punctuation">:</span> <span class="token string">&quot;/data/reconstruction&quot;</span></span>
<span class="line">    <span class="token key atrule">temp-path</span><span class="token punctuation">:</span> <span class="token string">&quot;/tmp/reconstruction&quot;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="æ€§èƒ½ä¼˜åŒ–ç­–ç•¥-ğŸš€" tabindex="-1"><a class="header-anchor" href="#æ€§èƒ½ä¼˜åŒ–ç­–ç•¥-ğŸš€"><span>æ€§èƒ½ä¼˜åŒ–ç­–ç•¥ ğŸš€</span></a></h2><h3 id="_1-å†…å­˜ç®¡ç†" tabindex="-1"><a class="header-anchor" href="#_1-å†…å­˜ç®¡ç†"><span>1. å†…å­˜ç®¡ç†</span></a></h3><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java"><pre><code class="language-java"><span class="line"><span class="token annotation punctuation">@Service</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PointCloudService</span> <span class="token punctuation">{</span></span>
<span class="line">    </span>
<span class="line">    <span class="token comment">// ä½¿ç”¨å¯¹è±¡æ± å‡å°‘GCå‹åŠ›</span></span>
<span class="line">    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">ObjectPool</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">PointCloudBuffer</span><span class="token punctuation">&gt;</span></span> bufferPool<span class="token punctuation">;</span></span>
<span class="line">    </span>
<span class="line">    <span class="token keyword">public</span> <span class="token class-name">ProcessingResult</span> <span class="token function">processLargePointCloud</span><span class="token punctuation">(</span><span class="token class-name">String</span> filePath<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token class-name">PointCloudBuffer</span> buffer <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">try</span> <span class="token punctuation">{</span></span>
<span class="line">            buffer <span class="token operator">=</span> bufferPool<span class="token punctuation">.</span><span class="token function">borrowObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            </span>
<span class="line">            <span class="token comment">// åˆ†å—å¤„ç†å¤§æ–‡ä»¶</span></span>
<span class="line">            <span class="token keyword">return</span> <span class="token function">processInChunks</span><span class="token punctuation">(</span>filePath<span class="token punctuation">,</span> buffer<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            </span>
<span class="line">        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">if</span> <span class="token punctuation">(</span>buffer <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                bufferPool<span class="token punctuation">.</span><span class="token function">returnObject</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    </span>
<span class="line">    <span class="token keyword">private</span> <span class="token class-name">ProcessingResult</span> <span class="token function">processInChunks</span><span class="token punctuation">(</span><span class="token class-name">String</span> filePath<span class="token punctuation">,</span> <span class="token class-name">PointCloudBuffer</span> buffer<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token constant">CHUNK_SIZE</span> <span class="token operator">=</span> <span class="token number">100000</span><span class="token punctuation">;</span> <span class="token comment">// 10ä¸‡ä¸ªç‚¹ä¸ºä¸€å—</span></span>
<span class="line">        </span>
<span class="line">        <span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">BufferedReader</span> reader <span class="token operator">=</span> <span class="token class-name">Files</span><span class="token punctuation">.</span><span class="token function">newBufferedReader</span><span class="token punctuation">(</span><span class="token class-name">Paths</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>filePath<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token class-name">String</span> line<span class="token punctuation">;</span></span>
<span class="line">            <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Point3D</span><span class="token punctuation">&gt;</span></span> chunk <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token constant">CHUNK_SIZE</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            </span>
<span class="line">            <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>line <span class="token operator">=</span> reader<span class="token punctuation">.</span><span class="token function">readLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token class-name">Point3D</span> point <span class="token operator">=</span> <span class="token function">parsePoint</span><span class="token punctuation">(</span>line<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                chunk<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>point<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                </span>
<span class="line">                <span class="token keyword">if</span> <span class="token punctuation">(</span>chunk<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;=</span> <span class="token constant">CHUNK_SIZE</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                    <span class="token function">processChunk</span><span class="token punctuation">(</span>chunk<span class="token punctuation">,</span> buffer<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                    chunk<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token punctuation">}</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">            </span>
<span class="line">            <span class="token comment">// å¤„ç†æœ€åä¸€å—</span></span>
<span class="line">            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>chunk<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token function">processChunk</span><span class="token punctuation">(</span>chunk<span class="token punctuation">,</span> buffer<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">        </span>
<span class="line">        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ProcessingResult</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-ç¼“å­˜ç­–ç•¥" tabindex="-1"><a class="header-anchor" href="#_2-ç¼“å­˜ç­–ç•¥"><span>2. ç¼“å­˜ç­–ç•¥</span></a></h3><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java"><pre><code class="language-java"><span class="line"><span class="token annotation punctuation">@Service</span></span>
<span class="line"><span class="token annotation punctuation">@EnableCaching</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AlgorithmService</span> <span class="token punctuation">{</span></span>
<span class="line">    </span>
<span class="line">    <span class="token annotation punctuation">@Cacheable</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;algorithms&quot;</span><span class="token punctuation">,</span> key <span class="token operator">=</span> <span class="token string">&quot;#algorithm + &#39;_&#39; + #parameters.hashCode()&quot;</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token class-name">AlgorithmConfig</span> <span class="token function">getAlgorithmConfig</span><span class="token punctuation">(</span><span class="token class-name">String</span> algorithm<span class="token punctuation">,</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> parameters<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token comment">// ä»æ•°æ®åº“åŠ è½½ç®—æ³•é…ç½®</span></span>
<span class="line">        <span class="token keyword">return</span> algorithmRepository<span class="token punctuation">.</span><span class="token function">findByNameAndParameters</span><span class="token punctuation">(</span>algorithm<span class="token punctuation">,</span> parameters<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    </span>
<span class="line">    <span class="token annotation punctuation">@CacheEvict</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;processing_results&quot;</span><span class="token punctuation">,</span> key <span class="token operator">=</span> <span class="token string">&quot;#taskId&quot;</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">clearProcessingCache</span><span class="token punctuation">(</span><span class="token class-name">String</span> taskId<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;æ¸…é™¤ä»»åŠ¡ç¼“å­˜: {}&quot;</span><span class="token punctuation">,</span> taskId<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="ç›‘æ§ä¸æ—¥å¿—-ğŸ“Š" tabindex="-1"><a class="header-anchor" href="#ç›‘æ§ä¸æ—¥å¿—-ğŸ“Š"><span>ç›‘æ§ä¸æ—¥å¿— ğŸ“Š</span></a></h2><h3 id="_1-è‡ªå®šä¹‰æŒ‡æ ‡" tabindex="-1"><a class="header-anchor" href="#_1-è‡ªå®šä¹‰æŒ‡æ ‡"><span>1. è‡ªå®šä¹‰æŒ‡æ ‡</span></a></h3><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java"><pre><code class="language-java"><span class="line"><span class="token annotation punctuation">@Component</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ProcessingMetrics</span> <span class="token punctuation">{</span></span>
<span class="line">    </span>
<span class="line">    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Counter</span> processedFiles<span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Timer</span> processingTime<span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Gauge</span> activeProcessing<span class="token punctuation">;</span></span>
<span class="line">    </span>
<span class="line">    <span class="token keyword">public</span> <span class="token class-name">ProcessingMetrics</span><span class="token punctuation">(</span><span class="token class-name">MeterRegistry</span> meterRegistry<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">this</span><span class="token punctuation">.</span>processedFiles <span class="token operator">=</span> <span class="token class-name">Counter</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token string">&quot;pointcloud.processed.total&quot;</span><span class="token punctuation">)</span></span>
<span class="line">            <span class="token punctuation">.</span><span class="token function">description</span><span class="token punctuation">(</span><span class="token string">&quot;å¤„ç†çš„ç‚¹äº‘æ–‡ä»¶æ€»æ•°&quot;</span><span class="token punctuation">)</span></span>
<span class="line">            <span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>meterRegistry<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            </span>
<span class="line">        <span class="token keyword">this</span><span class="token punctuation">.</span>processingTime <span class="token operator">=</span> <span class="token class-name">Timer</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token string">&quot;pointcloud.processing.duration&quot;</span><span class="token punctuation">)</span></span>
<span class="line">            <span class="token punctuation">.</span><span class="token function">description</span><span class="token punctuation">(</span><span class="token string">&quot;ç‚¹äº‘å¤„ç†è€—æ—¶&quot;</span><span class="token punctuation">)</span></span>
<span class="line">            <span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>meterRegistry<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            </span>
<span class="line">        <span class="token keyword">this</span><span class="token punctuation">.</span>activeProcessing <span class="token operator">=</span> <span class="token class-name">Gauge</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token string">&quot;pointcloud.processing.active&quot;</span><span class="token punctuation">)</span></span>
<span class="line">            <span class="token punctuation">.</span><span class="token function">description</span><span class="token punctuation">(</span><span class="token string">&quot;å½“å‰å¤„ç†ä¸­çš„ä»»åŠ¡æ•°&quot;</span><span class="token punctuation">)</span></span>
<span class="line">            <span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>meterRegistry<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token class-name">ProcessingMetrics</span><span class="token operator">::</span><span class="token function">getActiveTaskCount</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    </span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">recordProcessedFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        processedFiles<span class="token punctuation">.</span><span class="token function">increment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    </span>
<span class="line">    <span class="token keyword">public</span> <span class="token class-name">Timer<span class="token punctuation">.</span>Sample</span> <span class="token function">startProcessingTimer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token class-name">Timer</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span>processingTime<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-ç»“æ„åŒ–æ—¥å¿—" tabindex="-1"><a class="header-anchor" href="#_2-ç»“æ„åŒ–æ—¥å¿—"><span>2. ç»“æ„åŒ–æ—¥å¿—</span></a></h3><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java"><pre><code class="language-java"><span class="line"><span class="token annotation punctuation">@Slf4j</span></span>
<span class="line"><span class="token annotation punctuation">@Component</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ProcessingLogger</span> <span class="token punctuation">{</span></span>
<span class="line">    </span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">logProcessingStart</span><span class="token punctuation">(</span><span class="token class-name">String</span> taskId<span class="token punctuation">,</span> <span class="token class-name">String</span> algorithm<span class="token punctuation">,</span> <span class="token keyword">long</span> fileSize<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;å¼€å§‹å¤„ç†ç‚¹äº‘æ•°æ® - taskId: {}, algorithm: {}, fileSize: {}&quot;</span><span class="token punctuation">,</span> </span>
<span class="line">                taskId<span class="token punctuation">,</span> algorithm<span class="token punctuation">,</span> fileSize<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    </span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">logProcessingComplete</span><span class="token punctuation">(</span><span class="token class-name">String</span> taskId<span class="token punctuation">,</span> <span class="token keyword">long</span> duration<span class="token punctuation">,</span> <span class="token class-name">ProcessingResult</span> result<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;ç‚¹äº‘å¤„ç†å®Œæˆ - taskId: {}, duration: {}ms, success: {}, outputSize: {}&quot;</span><span class="token punctuation">,</span> </span>
<span class="line">                taskId<span class="token punctuation">,</span> duration<span class="token punctuation">,</span> result<span class="token punctuation">.</span><span class="token function">isSuccess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> result<span class="token punctuation">.</span><span class="token function">getOutputSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    </span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">logProcessingError</span><span class="token punctuation">(</span><span class="token class-name">String</span> taskId<span class="token punctuation">,</span> <span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;ç‚¹äº‘å¤„ç†å¤±è´¥ - taskId: {}, error: {}&quot;</span><span class="token punctuation">,</span> taskId<span class="token punctuation">,</span> e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="éƒ¨ç½²ä¸è¿ç»´-ğŸ› ï¸" tabindex="-1"><a class="header-anchor" href="#éƒ¨ç½²ä¸è¿ç»´-ğŸ› ï¸"><span>éƒ¨ç½²ä¸è¿ç»´ ğŸ› ï¸</span></a></h2><h3 id="dockeråŒ–éƒ¨ç½²" tabindex="-1"><a class="header-anchor" href="#dockeråŒ–éƒ¨ç½²"><span>DockeråŒ–éƒ¨ç½²</span></a></h3><div class="language-docker line-numbers-mode" data-highlighter="prismjs" data-ext="docker"><pre><code class="language-docker"><span class="line"><span class="token instruction"><span class="token keyword">FROM</span> openjdk:11-jre-slim</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># å®‰è£…Pythonç¯å¢ƒ</span></span>
<span class="line"><span class="token instruction"><span class="token keyword">RUN</span> apt-get update &amp;&amp; apt-get install -y python3 python3-pip</span></span>
<span class="line"><span class="token instruction"><span class="token keyword">COPY</span> requirements.txt /app/</span></span>
<span class="line"><span class="token instruction"><span class="token keyword">RUN</span> pip3 install -r /app/requirements.txt</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># å¤åˆ¶åº”ç”¨</span></span>
<span class="line"><span class="token instruction"><span class="token keyword">COPY</span> target/reconstruction-service-*.jar /app/app.jar</span></span>
<span class="line"><span class="token instruction"><span class="token keyword">COPY</span> algorithms/ /app/algorithms/</span></span>
<span class="line"></span>
<span class="line"><span class="token instruction"><span class="token keyword">WORKDIR</span> /app</span></span>
<span class="line"><span class="token instruction"><span class="token keyword">EXPOSE</span> 8080</span></span>
<span class="line"></span>
<span class="line"><span class="token instruction"><span class="token keyword">CMD</span> [<span class="token string">&quot;java&quot;</span>, <span class="token string">&quot;-jar&quot;</span>, <span class="token string">&quot;app.jar&quot;</span>]</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="å®¹å™¨ç¼–æ’" tabindex="-1"><a class="header-anchor" href="#å®¹å™¨ç¼–æ’"><span>å®¹å™¨ç¼–æ’</span></a></h3><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml"><pre><code class="language-yaml"><span class="line"><span class="token comment"># docker-compose.yml</span></span>
<span class="line"><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">&#39;3.8&#39;</span></span>
<span class="line"><span class="token key atrule">services</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">reconstruction-service</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">build</span><span class="token punctuation">:</span> .</span>
<span class="line">    <span class="token key atrule">ports</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> <span class="token string">&quot;8080:8080&quot;</span></span>
<span class="line">    <span class="token key atrule">environment</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> DB_HOST=mysql</span>
<span class="line">      <span class="token punctuation">-</span> REDIS_HOST=redis</span>
<span class="line">      <span class="token punctuation">-</span> MQ_HOST=rabbitmq</span>
<span class="line">    <span class="token key atrule">depends_on</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> mysql</span>
<span class="line">      <span class="token punctuation">-</span> redis</span>
<span class="line">      <span class="token punctuation">-</span> rabbitmq</span>
<span class="line">    <span class="token key atrule">volumes</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> reconstruction_data<span class="token punctuation">:</span>/data</span>
<span class="line">      </span>
<span class="line">  <span class="token key atrule">mysql</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">image</span><span class="token punctuation">:</span> mysql<span class="token punctuation">:</span><span class="token number">8.0</span></span>
<span class="line">    <span class="token key atrule">environment</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> MYSQL_ROOT_PASSWORD=password</span>
<span class="line">      <span class="token punctuation">-</span> MYSQL_DATABASE=reconstruction_db</span>
<span class="line">    <span class="token key atrule">volumes</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> mysql_data<span class="token punctuation">:</span>/var/lib/mysql</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="æ€»ç»“ä¸æ€è€ƒ-ğŸ’­" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“ä¸æ€è€ƒ-ğŸ’­"><span>æ€»ç»“ä¸æ€è€ƒ ğŸ’­</span></a></h2><p>é€šè¿‡è¿™ä¸ªé¡¹ç›®ï¼Œæˆ‘æ·±åˆ»ä½“ä¼šåˆ°äº†Spring Bootåœ¨å¤„ç†å¤æ‚ä¸šåŠ¡åœºæ™¯æ—¶çš„ä¼˜åŠ¿ï¼š</p><ol><li><strong>å¼€å‘æ•ˆç‡é«˜</strong>: è‡ªåŠ¨é…ç½®å’Œèµ·æ­¥ä¾èµ–å¤§å¤§å‡å°‘äº†é…ç½®å·¥ä½œ</li><li><strong>æ€§èƒ½ä¼˜å¼‚</strong>: é€šè¿‡åˆç†çš„æ¶æ„è®¾è®¡å’Œä¼˜åŒ–ï¼Œèƒ½å¤Ÿå¤„ç†å¤§è§„æ¨¡æ•°æ®</li><li><strong>æ‰©å±•æ€§å¥½</strong>: å¾®æœåŠ¡æ¶æ„ä¾¿äºåç»­åŠŸèƒ½æ‰©å±•</li><li><strong>è¿ç»´å‹å¥½</strong>: ä¸°å¯Œçš„ç›‘æ§å’Œæ—¥å¿—åŠŸèƒ½ä¾¿äºé—®é¢˜å®šä½</li></ol><p>ä¸‹ä¸€æ­¥è®¡åˆ’ï¼š</p><ul><li>å¼•å…¥Spring Cloudå®ç°çœŸæ­£çš„å¾®æœåŠ¡æ¶æ„</li><li>é›†æˆKubernetesè¿›è¡Œå®¹å™¨ç¼–æ’</li><li>æ·»åŠ æœºå™¨å­¦ä¹ æ¨¡å‹æœåŠ¡æ”¯æŒ</li></ul><hr><p>è¿™ä¸ªé¡¹ç›®è®©æˆ‘æ›´åŠ åšå®šäº†ä»äº‹Javaåç«¯å¼€å‘çš„å†³å¿ƒã€‚å°†å­¦æœ¯ç ”ç©¶ä¸å·¥ç¨‹å®è·µç»“åˆï¼Œä¸ä»…èƒ½å¤Ÿè§£å†³å®é™…é—®é¢˜ï¼Œè¿˜èƒ½æå‡è‡ªå·±çš„æŠ€æœ¯èƒ½åŠ›ã€‚</p><blockquote><p>å°±åƒå¾¡å‚ç¾ç´çš„ç”µç£ç‚®ä¸€æ ·ï¼ŒæŠ€æœ¯çš„åŠ›é‡éœ€è¦åœ¨å®è·µä¸­æ‰èƒ½çœŸæ­£å‘æŒ¥ä½œç”¨ï¼âš¡</p></blockquote>`,39)]))}const o=s(t,[["render",l]]),u=JSON.parse('{"path":"/posts/article1.html","title":"Spring Bootåœ¨ä¸‰ç»´æ•°æ®å¤„ç†ç³»ç»Ÿä¸­çš„åº”ç”¨å®è·µ â˜•","lang":"zh-CN","frontmatter":{"date":"2024-01-15T00:00:00.000Z","category":["JavaæŠ€æœ¯"],"tag":["Spring Boot","åç«¯å¼€å‘","å¾®æœåŠ¡"]},"git":{"updatedTime":1755348634000,"contributors":[{"name":"Misaka","username":"Misaka","email":"your-email@example.com","commits":1,"url":"https://github.com/Misaka"}],"changelog":[{"hash":"fe7910109b45f19e6aa70a60b1fe56f0e634bf59","time":1755348634000,"email":"your-email@example.com","author":"Misaka","message":"ğŸ‰ åˆå§‹åŒ–å¾¡å‚ç¾ç´çš„æŠ€æœ¯åšå®¢"}]},"filePathRelative":"posts/article1.md"}');export{o as comp,u as data};
